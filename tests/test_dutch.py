import unittest
from swissdutch.dutch import DutchPairingEngine
from swissdutch.constants import FideTitle, Colour, FloatStatus
from swissdutch.pairing import PairingCard

class Test_DutchPairingEngine(unittest.TestCase):
    def setUp(self):
        self.maxDiff = None
        self.engine  = DutchPairingEngine()

    def test_pair_second_round(self):
        input_pairing_cards = (
            PairingCard(surname='Alice',
                        rating=2500,
                        title=FideTitle.GM,
                        pairing_no=1,
                        score=1,
                        float_status=FloatStatus.none,
                        opponents=(8,),
                        colour_hist=(Colour.white,)),
            PairingCard(surname='Bruno',
                        rating=2500,
                        title=FideTitle.IM,
                        pairing_no=2,
                        score=1,
                        float_status=FloatStatus.none,
                        opponents=(9,),
                        colour_hist=(Colour.black,)),
            PairingCard(surname='Carla',
                        rating=2400,
                        title=FideTitle.WGM,
                        pairing_no=3,
                        score=1,
                        float_status=FloatStatus.none,
                        opponents=(10,),
                        colour_hist=(Colour.white,)),
            PairingCard(surname='David',
                        rating=2400,
                        title=FideTitle.FM,
                        pairing_no=4,
                        score=0.5,
                        float_status=FloatStatus.none,
                        opponents=(11,),
                        colour_hist=(Colour.black,)),
            PairingCard(surname='Eloise',
                        rating=2350,
                        title=FideTitle.WIM,
                        pairing_no=5,
                        score=1,
                        float_status=FloatStatus.none,
                        opponents=(12,),
                        colour_hist=(Colour.white,)),
            PairingCard(surname='Finn',
                        rating=2300,
                        title=FideTitle.FM,
                        pairing_no=6,
                        score=1,
                        float_status=FloatStatus.none,
                        opponents=(13,),
                        colour_hist=(Colour.black,)),
            PairingCard(surname='Giorgia',
                        rating=2250,
                        title=FideTitle.FM,
                        pairing_no=7,
                        score=1,
                        float_status=FloatStatus.none,
                        opponents=(14,),
                        colour_hist=(Colour.white,)),
            PairingCard(surname='Kevin',
                        rating=2250,
                        title=FideTitle.FM,
                        pairing_no=8,
                        score=0,
                        float_status=FloatStatus.none,
                        opponents=(1,),
                        colour_hist=(Colour.black,)),
            PairingCard(surname='Louise',
                        rating=2150,
                        title=FideTitle.WIM,
                        pairing_no=9,
                        score=0,
                        float_status=FloatStatus.none,
                        opponents=(2,),
                        colour_hist=(Colour.white,)),
            PairingCard(surname='Mark',
                        rating=2150,
                        title=FideTitle.CM,
                        pairing_no=10,
                        score=0,
                        float_status=FloatStatus.none,
                        opponents=(3,),
                        colour_hist=(Colour.black,)),
            PairingCard(surname='Nancy',
                        rating=2100,
                        title=FideTitle.WFM,
                        pairing_no=11,
                        score=0.5,
                        float_status=FloatStatus.none,
                        opponents=(4,),
                        colour_hist=(Colour.white,)),
            #PairingCard(surname='Oskar',
            #            rating=2100,
            #            title=0,
            #            pairing_no=12,
            #            score=0,
            #            float_status=FloatStatus.none,
            #            opponents=(5,),
            #            colour_hist=(Colour.black,)),
            PairingCard(surname='Patricia',
                        rating=2050,
                        title=0,
                        pairing_no=13,
                        score=0,
                        float_status=FloatStatus.none,
                        opponents=(6,),
                        colour_hist=(Colour.white,)),
            PairingCard(surname='Robert',
                        rating=2000,
                        title=0,
                        pairing_no=14,
                        score=0,
                        float_status=FloatStatus.none,
                        opponents=(7,),
                        colour_hist=(Colour.black,))
        )
        expected_pairing_cards = [
            PairingCard(surname='Alice',
                        rating=2500,
                        title=FideTitle.GM,
                        pairing_no=1,
                        score=1,
                        float_status=FloatStatus.none,
                        opponents=(8, 5),
                        colour_hist=(Colour.white, Colour.black)),
            PairingCard(surname='Bruno',
                        rating=2500,
                        title=FideTitle.IM,
                        pairing_no=2,
                        score=1,
                        float_status=FloatStatus.none,
                        opponents=(9, 7),
                        colour_hist=(Colour.black, Colour.white)),
            PairingCard(surname='Carla',
                        rating=2400,
                        title=FideTitle.WGM,
                        pairing_no=3,
                        score=1,
                        float_status=FloatStatus.none,
                        opponents=(10, 6),
                        colour_hist=(Colour.white, Colour.black)),
            PairingCard(surname='David',
                        rating=2400,
                        title=FideTitle.FM,
                        pairing_no=4,
                        score=0.5,
                        float_status=FloatStatus.down,
                        opponents=(11, 9),
                        colour_hist=(Colour.black, Colour.white)),
            PairingCard(surname='Eloise',
                        rating=2350,
                        title=FideTitle.WIM,
                        pairing_no=5,
                        score=1,
                        float_status=FloatStatus.none,
                        opponents=(12, 1),
                        colour_hist=(Colour.white, Colour.white)),
            PairingCard(surname='Finn',
                        rating=2300,
                        title=FideTitle.FM,
                        pairing_no=6,
                        score=1,
                        float_status=FloatStatus.none,
                        opponents=(13, 3),
                        colour_hist=(Colour.black, Colour.white)),
            PairingCard(surname='Giorgia',
                        rating=2250,
                        title=FideTitle.FM,
                        pairing_no=7,
                        score=1,
                        float_status=FloatStatus.none,
                        opponents=(14, 2),
                        colour_hist=(Colour.white, Colour.black)),
            PairingCard(surname='Kevin',
                        rating=2250,
                        title=FideTitle.FM,
                        pairing_no=8,
                        score=0,
                        float_status=FloatStatus.up,
                        opponents=(1, 11),
                        colour_hist=(Colour.black, Colour.white)),
            PairingCard(surname='Louise',
                        rating=2150,
                        title=FideTitle.WIM,
                        pairing_no=9,
                        score=0,
                        float_status=FloatStatus.up,
                        opponents=(2, 4),
                        colour_hist=(Colour.white, Colour.black)),
            PairingCard(surname='Mark',
                        rating=2150,
                        title=FideTitle.CM,
                        pairing_no=10,
                        score=0,
                        float_status=FloatStatus.none,
                        opponents=(3, 13),
                        colour_hist=(Colour.black, Colour.white)),
            PairingCard(surname='Nancy',
                        rating=2100,
                        title=FideTitle.WFM,
                        pairing_no=11,
                        score=0.5,
                        float_status=FloatStatus.down,
                        opponents=(4, 8),
                        colour_hist=(Colour.white, Colour.black)),
            #PairingCard(surname='Oskar',
            #            rating=2100,
            #            title=0,
            #            pairing_no=12,
            #            score=0,
            #            float_status=FloatStatus.none,
            #            opponents=(5,),
            #            colour_hist=(Colour.black,)),
            PairingCard(surname='Patricia',
                        rating=2050,
                        title=0,
                        pairing_no=13,
                        score=0,
                        float_status=FloatStatus.none,
                        opponents=(6, 10),
                        colour_hist=(Colour.white, Colour.black)),
            PairingCard(surname='Robert',
                        rating=2000,
                        title=0,
                        pairing_no=14,
                        score=1,
                        float_status=FloatStatus.down,
                        opponents=(7, 0),
                        colour_hist=(Colour.black, Colour.none))
        ]

        result_pairing_cards = self.engine.pair_round(2, input_pairing_cards)
        self.assertCountEqual(result_pairing_cards, expected_pairing_cards)